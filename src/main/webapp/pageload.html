<!DOCTYPE html>
<html>
<head>
    <title>NGRNetwork</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style/bootstrap.min.css">
    <link rel="stylesheet" href="font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style/icon.css">
    <link rel="stylesheet" href="style/loader.css">
    <link rel="stylesheet" href="style/idangerous.swiper.css">
    <link rel="stylesheet" href="style/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="style/ie-9.css" />
    <script src="script/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="script/respond/1.4.2/respond.min.js"></script>

    <link rel="stylesheet" href="css/style2.css">

    <link rel="stylesheet" href="plugins/wangeditor/wangEditor.min.css" />
    <script src="plugins/wangeditor/wangEditor.js"></script>
    <script src="js/jquery-1.8.2.js"></script>
</head>

<body class="page-login">>
    <header>
        <!--引入头部-->
        <div id="headLoad">	</div>
        <script>
            $.ajax({
                type: "GET",
                url: "getSessionLoginInfo",
                success: function (data) {
                    if (data) {
                        $("#headLoad").load("header2.html")
                    } else {
                        $("#headLoad").load("header1.html")
                    }
                }
            })
        </script>
    </header>
    <main id="tt-pageContent">
        <div class="container">
            <div class="tt-wrapper-inner">
                <h1 class="tt-title-border"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建新主题</font></font>
                </h1>
                <form class="form-default form-create-topic">
                    <div class="form-group"><label for="inputTopicTitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">博客标题</font></font></label>
                        <div class="tt-value-wrapper"><input type="text" name="name" class="form-control" id="inputTopicTitle" placeholder="请输入标题" maxlength="20" ><span class="tt-value-input"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大输入长度为20</font></font></span></div>
                        <div class="tt-note">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">请描述您博客主题，同时尽可能缩短主题。</font>
                            </font>
                        </div>
                    </div>

                    <div class="pt-editor">
                        <h6 class="pt-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">博客正文</font></font>
                        </h6>
                        <div id="editor"></div>
                        <div style="min-height: 20px"></div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group"><label for="inputTopicTitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别</font></font></label>
                                    <select class="form-control" id="category">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="form-group"><label for="inputTopicTags"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></label><input type="text" name="name" class="form-control" id="inputTopicTags" placeholder="Use comma to separate tags">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-auto ml-md-auto">
                                <a href="#" class="btn btn-secondary btn-width-lg" id="test1">
                                    <font style="vertical-align: inherit;">
                                        <font style="vertical-align: inherit;">创建帖子</font>
                                    </font>
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="tt-topic-list tt-offset-top-30">
                <div class="tt-list-search">
                    <div class="tt-title">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">建议的主题</font>
                        </font>
                    </div>
                    <!-- tt-search -->
                    <div class="tt-search">
                        <form class="search-wrapper">
                            <div class="search-form"><input type="text" class="tt-search__input" placeholder="Search for topics">
                                <button class="tt-search__btn" type="submit">
                                    <svg class="tt-icon">
                                        <use xlink:href="#icon-search"></use>
                                    </svg>
                                </button>
                                <button class="tt-search__close">
                                    <svg class="tt-icon">
                                        <use xlink:href="#icon-cancel"></use>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>
                    <!-- /tt-search -->
                </div>
                <div class="tt-list-header tt-border-bottom">
                    <div class="tt-col-topic">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">话题</font>
                        </font>
                    </div>
                    <div class="tt-col-category">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">类别</font>
                        </font>
                    </div>
                    <div class="tt-col-value hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">喜欢</font>
                        </font>
                    </div>
                    <div class="tt-col-value hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">回复</font>
                        </font>
                    </div>
                    <div class="tt-col-value hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">查看</font>
                        </font>
                    </div>
                    <div class="tt-col-value">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">活动</font>
                        </font>
                    </div>
                </div>
                <div class="tt-item">
                    <div class="tt-col-avatar">
                        <svg class="tt-icon">
                            <use xlink:href="#icon-ava-n"></use>
                        </svg>
                    </div>
                    <div class="tt-col-description">
                        <h6 class="tt-title"><a href="#"><font style="vertical-align: inherit;"><font
                                style="vertical-align: inherit;"> Envato是否针对Envato市场的作者？ </font></font></a></h6>
                        <div class="row align-items-center no-gutters hide-desktope">
                            <div class="col-auto">
                                <ul class="tt-list-badge">
                                    <li class="show-mobile">
                                        <a href="#"><span class="tt-color05 tt-badge">music</span></a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-auto ml-auto show-mobile">
                                <div class="tt-value">1d</div>
                            </div>
                        </div>
                    </div>
                    <div class="tt-col-category"><span class="tt-color05 tt-badge"><font
                            style="vertical-align: inherit;"><font style="vertical-align: inherit;">音乐</font></font></span>
                    </div>
                    <div class="tt-col-value hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">358</font>
                        </font>
                    </div>
                    <div class="tt-col-value tt-color-select hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">68</font>
                        </font>
                    </div>
                    <div class="tt-col-value hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">8.3k</font>
                        </font>
                    </div>
                    <div class="tt-col-value hide-mobile">
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;">1D</font>
                        </font>
                    </div>
                </div>
            </div>
        </div>
    </main>
<footer>
    <div id="footerInfo">
        <script>
            $("#footerInfo").load("footer.html")
        </script>
    </div>
</footer>


<script type="text/javascript">

    $.ajax({
        type:'GET',
        url:'getCategoryIdList',
        contentType: "application/json; charset=utf-8",
        success:function (responseText) {
            $(responseText).each(function (idex,item) {
                var option ="<option value=\""+item.categoryId+"\">\n" +
                    "<font style=\"vertical-align: inherit;\">"+item.categoryName+"</font>\n" +
                    "</option>";
                $("#category").append(option);
            });

        },error:function(){
            alert("服务丢失")
        },
        dataType:'json'
    })



    var E = window.wangEditor;//声明一个wangEditor对象
    var editor = new E('#editor'); // 两个参数也可以传入 elem 对象，class 选择器
    //开启debug模式
    editor.customConfig.debug = true;
    // 关闭粘贴内容中的样式
    editor.customConfig.pasteFilterStyle = false;
    // 忽略粘贴内容中的图片
    editor.customConfig.pasteIgnoreImg = false;
    // 使用 base64 保存图片
    //editor.customConfig.uploadImgShowBase64 = true
    // 上传图片到服务器
    editor.customConfig.uploadFileName = 'editorFile'; //设置文件上传的参数名称
    editor.customConfig.uploadImgServer = 'upload'; //设置上传文件的服务器路径
    editor.customConfig.uploadImgMaxSize = 200 * 1024 * 1024; // 将图片大小限制为 3M
    //自定义上传图片事件
    editor.customConfig.uploadImgHooks = {
        before: function(xhr, editor, files) {

        },
        success: function(xhr, editor, result) {
            console.log("上传成功");
        },
        fail: function(xhr, editor, result) {
            console.log("上传失败,原因是" + result);
        },
        error: function(xhr, editor) {
            console.log("上传出错");
        },
        timeout: function(xhr, editor) {
            console.log("上传超时");
        }
    }

    editor.create();

    $("#test1").bind("click",function(){
        $.ajax({
            type:'POST',
            url:'addArticle',
            contentType: "application/json; charset=utf-8",
            data:JSON.stringify({
                "userInfoId":7,
                "content":editor.txt.html(),
                "categoryId":$("#category").val(),
                "title":$("#inputTopicTitle").val(),
            }),
            success:function (responseText) {
                if(responseText==true){
                    document.write("发布成功，页面将在1秒后跳转到首页");
                    setTimeout(function(){
                        window.location.href = "index.html";
                    },1000)

                }else {
                    alert("发表失败");
                }
            },error:function(){
                alert("服务器错误，等待程序员维修")
            },
            dataType:'json'
        })
    });

</script>
</body>
</html>
